import streamlit as st
from datetime import datetime

st.set_page_config(page_title="–®–∫–æ–ª—å–Ω—ã–π –±–æ—Ç-–ø–æ–º–æ—â–Ω–∏–∫", page_icon="ü§ñ")
st.title("ü§ñ –®–∫–æ–ª—å–Ω—ã–π –±–æ—Ç-–ø–æ–º–æ—â–Ω–∏–∫ (–¥–µ–º–æ –Ω–∞ Streamlit)")

st.caption("–î–µ–º–æ –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö API: –ª–æ–≥–∏–∫–∞ –æ—Ç–≤–µ—Ç–∞ ‚Äî –ø—Ä–æ—Å—Ç–∞—è, –Ω–æ —á–∞—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –ø—Ä–æ–¥—É–∫—Ç.")

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ "—Ä–æ–ª–∏" –±–æ—Ç–∞ (–∏—Ö —É–¥–æ–±–Ω–æ –¥–∞–≤–∞—Ç—å —à–∫–æ–ª—å–Ω–∏–∫–∞–º –¥–ª—è –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–∏)
with st.sidebar:
    st.header("–ù–∞—Å—Ç—Ä–æ–π–∫–∏")
    bot_name = st.text_input("–ò–º—è –±–æ—Ç–∞", "–£—á–µ–±–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫")
    mode = st.selectbox(
        "–†–µ–∂–∏–º",
        ["–û–±—ä—è—Å–Ω—è—é —Ç–µ–º—É", "–¢—Ä–µ–Ω–∏—Ä—É—é (–≤–æ–ø—Ä–æ—Å—ã)", "–ü—Ä–æ–≤–µ—Ä—è—é –æ—Ç–≤–µ—Ç", "–ü–ª–∞–Ω –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏"]
    )
    subject = st.text_input("–ü—Ä–µ–¥–º–µ—Ç/—Ç–µ–º–∞", "–ò—Å—Ç–æ—Ä–∏—è")
    tone = st.selectbox("–¢–æ–Ω", ["–¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π", "—Å—Ç—Ä–æ–≥–∏–π", "–Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π"])
    st.divider()
    st.write("–ü–æ–¥—Å–∫–∞–∑–∫–∞: —ç—Ç–æ –¥–µ–º–æ –±–µ–∑ –ò–ò. –ó–∞—Ç–æ –º–æ–∂–Ω–æ –±—ã—Å—Ç—Ä–æ –ø–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏ –ª–æ–≥–∏–∫—É –ø—Ä–æ–¥—É–∫—Ç–∞.")

# –ü–∞–º—è—Ç—å —á–∞—Ç–∞
if "messages" not in st.session_state:
    st.session_state.messages = [
        {"role": "assistant", "content": f"–ü—Ä–∏–≤–µ—Ç! –Ø {bot_name}. –ù–∞–ø–∏—à–∏ —Ç–µ–º—É –∏–ª–∏ –≤–æ–ø—Ä–æ—Å ‚Äî –Ω–∞—á–Ω—ë–º."}
    ]

# –†–µ–Ω–¥–µ—Ä –∏—Å—Ç–æ—Ä–∏–∏
for m in st.session_state.messages:
    with st.chat_message(m["role"]):
        st.markdown(m["content"])

def demo_reply(user_text: str) -> str:
    """–ü—Ä–æ—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤ ‚Äî –∏–º–∏—Ç–∞—Ü–∏—è "—É–º–Ω–æ–≥–æ" –ø–æ–≤–µ–¥–µ–Ω–∏—è."""
    base = f"**{bot_name}** ({mode}, {tone}). –¢–µ–º–∞: *{subject}*.\n\n"

    if mode == "–û–±—ä—è—Å–Ω—è—é —Ç–µ–º—É":
        return base + (
            f"–í–æ—Ç –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø–æ –∑–∞–ø—Ä–æ—Å—É: **{user_text}**\n\n"
            "1) –°—É—Ç—å –≤ –æ–¥–Ω–æ–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–∏.\n"
            "2) –ö–ª—é—á–µ–≤—ã–µ –ø–æ–Ω—è—Ç–∏—è (3‚Äì5 –ø—É–Ω–∫—Ç–æ–≤).\n"
            "3) –ü—Ä–∏–º–µ—Ä.\n"
            "4) –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π –≤–æ–ø—Ä–æ—Å: *—á—Ç–æ –∏–∑ —ç—Ç–æ–≥–æ —Å–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ –∏ –ø–æ—á–µ–º—É?*"
        )

    if mode == "–¢—Ä–µ–Ω–∏—Ä—É—é (–≤–æ–ø—Ä–æ—Å—ã)":
        return base + (
            "–î–∞–≤–∞–π –ø–æ—Ç—Ä–µ–Ω–∏—Ä—É–µ–º—Å—è. –û—Ç–≤–µ—Ç—å –∫–æ—Ä–æ—Ç–∫–æ:\n"
            "1) –ß—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ?\n"
            "2) –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ?\n"
            "3) –ü—Ä–∏–≤–µ–¥–∏ –ø—Ä–∏–º–µ—Ä.\n\n"
            f"–¢–≤–æ–π –≤—Ö–æ–¥: **{user_text}** ‚Äî –º–æ–∂–µ—à—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ –∏—Å—Ö–æ–¥–Ω—É—é —Ç–µ–º—É."
        )

    if mode == "–ü—Ä–æ–≤–µ—Ä—è—é –æ—Ç–≤–µ—Ç":
        return base + (
            "–ü—Ä–æ–≤–µ—Ä–∫–∞ (–¥–µ–º–æ):\n"
            "- –ß—Ç–æ —Ö–æ—Ä–æ—à–æ: –µ—Å—Ç—å –ø–æ–ø—ã—Ç–∫–∞ –æ–±—ä—è—Å–Ω–∏—Ç—å.\n"
            "- –ß—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å: –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∏ –ø—Ä–∏–º–µ—Ä.\n"
            "- –ß—Ç–æ —É—Ç–æ—á–Ω–∏—Ç—å: –ø—Ä–∏—á–∏–Ω–Ω–æ-—Å–ª–µ–¥—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–≤—è–∑–∏.\n\n"
            "–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, –ø—Ä–∏—à–ª–∏ –æ—Ç–≤–µ—Ç –µ—â—ë —Ä–∞–∑ –≤ —Ñ–æ—Ä–º–∞—Ç–µ: *–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ ‚Üí 2 —Ñ–∞–∫—Ç–∞ ‚Üí –ø—Ä–∏–º–µ—Ä*."
        )

    # –ü–ª–∞–Ω –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏
    return base + (
        f"–ü–ª–∞–Ω –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –ø–æ —Ç–µ–º–µ **{user_text}** –Ω–∞ 3 —à–∞–≥–∞:\n"
        "1) –ö–æ—Ä–æ—Ç–∫–∏–π –∫–æ–Ω—Å–ø–µ–∫—Ç (10‚Äì15 –º–∏–Ω)\n"
        "2) 10 –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è —Å–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∏\n"
        "3) –ú–∏–Ω–∏-—Ç–µ—Å—Ç + —Ä–∞–∑–±–æ—Ä –æ—à–∏–±–æ–∫\n\n"
        f"–°–µ–≥–æ–¥–Ω—è: {datetime.now().strftime('%d.%m.%Y')}"
    )

# –í–≤–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
prompt = st.chat_input("–ù–∞–ø–∏—à–∏ –≤–æ–ø—Ä–æ—Å –∏–ª–∏ —Ç–µ–º—É‚Ä¶")
if prompt:
    st.session_state.messages.append({"role": "user", "content": prompt})
    with st.chat_message("user"):
        st.markdown(prompt)

    answer = demo_reply(prompt)
    st.session_state.messages.append({"role": "assistant", "content": answer})
    with st.chat_message("assistant"):
        st.markdown(answer)
